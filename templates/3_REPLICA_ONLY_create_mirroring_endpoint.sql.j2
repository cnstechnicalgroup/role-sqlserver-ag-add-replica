IF NOT EXISTS ( SELECT * FROM sys.tcp_endpoints WHERE name = 'Hadr_endpoint')
BEGIN
	CREATE ENDPOINT [Hadr_endpoint]
		AS TCP (LISTENER_IP = (0.0.0.0), LISTENER_PORT = 5022)
		FOR DATA_MIRRORING (
			ROLE = ALL,
			AUTHENTICATION = CERTIFICATE dbm_certificate,
			ENCRYPTION = REQUIRED ALGORITHM AES
			);
END

ALTER ENDPOINT [Hadr_endpoint] STATE = STARTED;
GRANT CONNECT ON ENDPOINT::[Hadr_endpoint] TO [dbm_login];
